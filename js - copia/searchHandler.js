// ✅ searchHandler.js — búsqueda global
 document.addEventListener('DOMContentLoaded',()=>{const o=document.getElementById('search-overlay'),i=document.getElementById('searchInput'),c=document.getElementById('closeSearch'),r=document.getElementById('searchResults');if(!o||!i)return;const d=(f,m)=>{let t;return(...a)=>{clearTimeout(t);t=setTimeout(()=>f(...a),m)}};const buscar=d(async q=>{if(!q.trim()){r.innerHTML='';return;}r.innerHTML='<div class="muted p-2">Buscando...</div>';try{const res=await fetch(CONFIG.apiURL+'search_advanced.php?q='+encodeURIComponent(q));const data=await res.json();if(!data||data.status!=='ok'||!data.productos.length){r.innerHTML='<div class="muted p-2">Sin resultados</div>';return;}r.innerHTML=data.productos.map(p=>`<div class='search-item' data-cod='${p.codigo}'><img class='search-thumb' src='${p.imagen}'><div class='search-text'><div class='line-1'>${p.codigo}</div><div class='line-2'>${p.descripcion}</div></div></div>`).join('')}catch(e){r.innerHTML='<div class="text-danger p-2">Error en búsqueda</div>';}} ,300);i.addEventListener('input',e=>buscar(e.target.value));r.addEventListener('click',e=>{const it=e.target.closest('.search-item');if(!it)return;const cod=it.dataset.cod;window.location.href=CONFIG.baseURL+'pages/shop.php?cod='+encodeURIComponent(cod)});document.querySelectorAll('.js-show-search').forEach(b=>b.onclick=()=>{o.classList.add('active');i.focus()});c.onclick=()=>{o.classList.remove('active');i.value='';r.innerHTML=''};o.onclick=e=>{if(e.target===o)o.classList.remove('active')}});